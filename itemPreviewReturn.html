<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link rel="stylesheet" href="css/form.css">
    <link rel="icon" href="images/favicon.png" type="image/png">
    <title>Sales Preview</title>
</head>
<body>
    <div class="container">
        <!-- Sidebar Section -->
        <div class="left-side">
            <div class="corner">
                <a onclick="goHome(); return false">
                    <div class="logo">
                        <h2><b class="color2">Insanj</b></h2>
                        <img src="images/logoBox.png">
                    </div>
                </a>
            </div>
            <script>
                function goHome(){
                    window.location.href = "index.html";
                }
            </script>
        </div>
        
        <br><br>
        <div class="center">
            <div class="input-container">
                <div class="formHead">
                    <h1 style="color: #ffffff;">Returned Sales Preview</h1>
                </div>
                <br>
                <div class="view-container">
                    <h3 id="saleDate"></h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Qty</th>
                                <th>Items</th>
                                <th>Price</th>
                                <th>Expenses</th>
                                <th>Note</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="itemDetails"></tbody>
                    </table>
                    <p style="margin-bottom: 10px;">
                        <strong class="totalAm">Total Amount:</strong> 
                        <span class="totalAmount" id="totalAmount"></span>
                    </p>
                    <button id="deleteButton" aria-label="Delete Sale">Delete</button>
                    <button id="backButton" aria-label="Go Back">Back</button>
                </div>
            </div>
        </div>
        <!-- Right Section -->
        <div class="right-side">
            <div class="nav">
                <div class="right-corner">
                    <a onclick="goHome(); return false">
                        <div class="logo">
                            <h2><b class="color2">Insanj</b></h2>
                            <img src="images/logoBox.png">
                        </div>
                    </a>
                </div>
                <div class="menus">
                    <button class="hideBar">
                        <span class="fa fa-times hamburger activate"></span>
                    </button>
                    <button class="showBar">
                        <span class="fa fa-bars bars"></span>
                    </button>
                </div>
                <div class="innerNav">            
                    <div class="dark-mode">
                        <div class="ico">
                            <span class="material-icons-sharp active">light_mode</span>
                            <span class="material-icons-sharp">dark_mode</span>
                        </div>
                        <div class="ico-letters">
                            <h3>Themes</h3>
                        </div>
                    </div>
                    <hr class="lines" style="order: 1;">
                    <div class="inventory" onclick="openInventory(); return false">
                        <div class="ico">
                            <span class="material-icons-sharp" style="color: #1B9C85;">library_books</span>
                        </div>
                        <div class="ico-letters">
                            <h3>Inventory</h3>
                            <span class="text">Monitor your business inventory</span>
                        </div>
                    </div>
                    <hr class="lines">
                    <script>
                        function openInventory(){
                            window.location.href = 'inventory.html';
                        }
                    </script>
                    <div class="notify">
                        <div class="ico">
                            <span class="material-icons-sharp" style="color: #1B9C85;">notifications</span>
                        </div>
                        <div class="ico-letters">
                            <h3>Notification</h3>
                            <span id="alert"></span>
                        </div>
                    </div>
                    <hr class="lines">
                    <div class="predictor">
                        <div class="ico">
                            <span class="material-icons-sharp" style="color: #c440a7;">online_prediction</span>
                        </div>
                        <div class="ico-letters">
                            <h3>Predictive Analysis</h3>
                            <span class="text">Forecast future sales and scenarios</span>
                        </div>
                    </div>
                    <hr class="lines">
                    <div class="copy-write">
                        <h5>2024 Copyright: Lechi-Tech</h5>
                    </div>
                </div>
            
                <div class="profile">
                    <div class="about">
                        <p>Hey, <b>Lechi</b></p>
                        <small class="admin">Admin</small>
                    </div>
                    <div class="displayPic usersDetails">
                        <img src="images/blank-person-icon-9.jpg">
                    </div>
                </div>
            </div>
            
            <div class="details usersDetails">
                <div class="user-profile">
                    <div class="profile_image" style="margin-left: 10px;">
                        <input type="file" class="image_file">
                    </div>
                    <div class="profile_names" style="margin-top: 10px;">
                        <h2>Administrator</h2>
                        <p>Admin</p>
                    </div>
                </div>
                <div class="sidebar">
                    <a href="#" onclick="goHome(); return false">
                        <span class="material-icons-sharp">home</span>
                        <h3>Home</h3>
                    </a>
                    <a href="#" onclick="openProfile(); return false">
                        <span class="material-icons-sharp">
                            account_circle</span>
                        <h3>Profile</h3>
                    </a>
                    <a href="#" class="" onclick="openProfile()">
                        <span class="material-icons-sharp">business</span>
                        <h3>Business Profile</h3>
                    </a>
                    <a href="#" onclick="openProfile(); return false">
                        <span class="material-icons-sharp">manage_accounts</span>
                        <h3>Account</h3>
                    </a>
                    <a href="#" onclick="openProfile(); return false">
                        <span class="material-icons-sharp">notifications</span>
                        <h3>Notifications</h3>
                    </a>
                    <a href="#">
                        <span class="material-icons-sharp">logout</span>
                        <h3>Logout</h3>
                    </a>
                    <script>
                        function openProfile(){
                            window.location.href = 'profile.html';
                        }
                        function goHome(){
                            window.location.href = "index.html";
                        }
                    </script>
                </div>
            </div>
            <!-- End of Nav -->
        </div>
        <div class="footer">
            <div class="foot">
                <nav class="footer-nav"> Â© 2024 Copyright: Lechi-Tech</a></nav>
                <a href="#" class="footer-link"><img src="images/Lechi Logo.png" alt="logoImage"></a>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const displayPic = document.querySelector('.displayPic.usersDetails');
            const details = document.querySelector('.details');
    
            displayPic.addEventListener('click', function (event) {
                details.classList.toggle('active');
                event.stopPropagation(); // Prevents the click event from propagating to document
            });
    
            // Close details when clicking outside of it
            document.addEventListener('click', function (event) {
                if (!details.contains(event.target) && !displayPic.contains(event.target)) {
                    details.classList.remove('active');
                }
            });
        });
    </script>
    
    <script>
        $(document).ready(function () {
            const params = new URLSearchParams(window.location.search);
            const returnsId = params.get('id'); // Get the returns ID from the URL
    
            // Fetch item details based on the returns ID
            fetchItemDetails(returnsId);
    
            // Back button functionality
            $("#backButton").on("click", function () {
                window.history.back(); // Navigate back to the previous page
            });
        });
    
        function fetchItemDetails(returnsId) {
            $.ajax({
                url: `http://localhost:3000/returnSales/${returnsId}`, // Updated to match the correct endpoint
                method: "GET",
                beforeSend: function() {
                    // Show loading indicator
                    $("#itemDetails").html("<tr><td colspan='6'>Loading...</td></tr>");
                },
                success: function (data) {
                    // Check if 'returns' and the associated sale data are defined
                    if (data.returns && data.returns.saleId) {
                        $("#saleDate").text(new Date(data.returns.saleId.saleDate).toLocaleDateString());
    
                        const itemRow = `
                            <tr>
                                <td>${data.returns.quantity}</td>
                                <td>${data.returns.product.name}</td>
                                <td>${data.returns.price.toLocaleString()}</td>
                                <td>${data.returns.expenses ? data.returns.expenses.toLocaleString() : '0'}</td>
                                <td>${data.returns.note || 'N/A'}</td>
                                <td>${data.returns.totalAmount.toLocaleString()}</td>
                            </tr>
                        `;
                        $("#itemDetails").html(itemRow);
                        $("#totalAmount").text(`${data.returns.totalAmount.toLocaleString()}`); // Display total amount
                    } else {
                        $("#itemDetails").html("<tr><td colspan='6'>No items found.</td></tr>");
                    }
                },
                error: function (error) {
                    showNotification("Failed to fetch item details.", "error");
                    $("#itemDetails").html("<tr><td colspan='6'>Failed to fetch item details.</td></tr>");
                    console.error("Failed to fetch item details.", error);
                }
            });
        }
    
        // Delete button functionality
        $("#deleteButton").on("click", function () {
            const returnsId = new URLSearchParams(window.location.search).get('id');
    
            // Confirm deletion
            if (confirm("Are you sure you want to delete this item?")) {
                $.ajax({
                    url: `http://localhost:3000/returnSales/${returnsId}`,
                    method: "DELETE",
                    success: function () {
                        showNotification("Item deleted successfully!", "success");
                        window.location.href = 'index.html';
                    },
                    error: function (error) {
                        showNotification("Failed to delete item.", "error");
                    }
                });
            }
        });
    
        function showNotification(message, type = 'info') {
            const notification = $("#notification");
            $("#notification-message").text(message);
    
            // Change notification style based on type
            if (type === 'success') {
                notification.css('background-color', 'green');
            } else if (type === 'warning') {
                notification.css('background-color', 'orange');
            } else if (type === 'error') {
                notification.css('background-color', 'red');
            } else {
                notification.css('background-color', 'blue');
            }
    
            // Set text color to white
            notification.css('color', '#ffffff');
    
            notification.fadeIn(300).delay(5000).fadeOut(300);
        }
    </script>    

    <style>
        .view-container {
            background-color: var(--color-white);
            width: 100%;
            padding: 20px;
            border-radius: 8px;
            padding: 30px; /* Increased padding for better spacing */
            margin-bottom: 20px;
        }

        .h2Table {
            margin-bottom: 10px;
        }

        #saleDate {
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #1B9C85;
            color: #ffffff;
            border-spacing: 0;
        }

        table thead tr th:nth-child(1), tbody tr td:nth-child(1) {
            font-weight: bold;
            text-align: center;
            width: 30px;
            max-width: 35px;
            border-radius: 4px 0 0 4px;
        }

        table thead tr th:nth-child(2) {
            width: 90px;
            max-width: 100px;
        }

        table thead tr th:nth-child(5) {
            width: 190px;
            max-width: 200px;
        }

        table thead tr th:nth-child(3), tbody tr td:nth-child(3),
        table thead tr th:nth-child(4), tbody tr td:nth-child(4),
        table thead tr th:nth-child(6), tbody tr td:nth-child(6) {
            font-weight: bold;
            text-align: center; 
            width: 50px;
            max-width: 55px;
        }

        table thead tr th:nth-child(6), tbody tr td:nth-child(6) {
            border-radius: 0 4px 4px 0;
        }

        .totalAm {
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .totalAmount {
            color: #1B9C85;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 20px;
        }

        .view-container button {
            margin-top: 10px;
            margin-right: 10px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #editButton {
            background-color: #1B9C85;
            color: white;
        }

        #deleteButton {
            background-color: #dc3545;
            color: white;
        }

        #backButton {
            background-color: #6c757d;
            color: white;
        }

        button:hover {
            opacity: 0.9;
            transition: 0.3s;
        }

        @media (max-width: 1200px) {
            .view-container {
                padding: 15px;
            }

            table thead tr th:nth-child(1), tbody tr td:nth-child(1) {
                width: 25px;
                max-width: 30px;
            }

            table thead tr th:nth-child(2) {
                width: 80px;
                max-width: 90px;
            }

            table thead tr th:nth-child(5) {
                width: 150px;
                max-width: 160px;
            }

            table thead tr th:nth-child(3), tbody tr td:nth-child(3),
            table thead tr th:nth-child(4), tbody tr td:nth-child(4),
            table thead tr th:nth-child(6), tbody tr td:nth-child(6) {
                width: 45px;
                max-width: 50px;
            }

            .view-container button {
                padding: 8px 12px;
                font-size: 14px;
            }
        }

        @media (max-width: 768px) {
            .view-container {
                padding: 10px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px;
                font-size: 12px;
            }

            table thead tr th:nth-child(1), tbody tr td:nth-child(1) {
                width: 20px;
                max-width: 25px;
            }

            table thead tr th:nth-child(2) {
                width: 60px;
                max-width: 70px;
            }

            table thead tr th:nth-child(5) {
                width: 70px;
                max-width: 80px;
            }

            table thead tr th:nth-child(3), tbody tr td:nth-child(3),
            table thead tr th:nth-child(4), tbody tr td:nth-child(4) {
                display: none;
            }

            table thead tr th:nth-child(6), tbody tr td:nth-child(6) {
                width: 65px;
                max-width: 65px;
            }

            .view-container button {
                padding: 6px 10px;
                font-size: 12px;
            }

            h2.h2Table {
                font-size: 16px;
                margin-bottom: 8px;
            }

            #saleDate {
                margin-bottom: 8px;
            }

            .totalAmount {
                font-size: 18px;
            }
            
            .totalAm {
                font-size: 14px;
            }
        }
    </style>
    <script src="js/dlMood.js"></script>
</body>
</html>
